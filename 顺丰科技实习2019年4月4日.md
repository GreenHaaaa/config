# 顺丰科技实习

*2019年4月4日 刘林杰*

## 今天内容

- 智慧中转平台需求分配
  - 负责中转站基础数据新增**国际件路由代码**的导入导出以及查询功能
  - 负责中转平台丰声用户批量导入开发

- 智慧中转平台代码阅读
  - 导出功能接口模版梳理
  - 导出功能接口模版梳理

## 下周计划

- 进入智慧中转平台V1.7版本开发编码阶段
- 理解智慧中转平台整体架构
- 了解部门业务

## 感想收获

- 匿名内部类对外部参数的引用。在导入接口功能中，一个类型为IExcelVerifyHandler的匿名内部被创建被作为检验参数的处理器校验excel。在该内部类中，引用了成员方法中的几个参数（预先定义好的校验之后的结果集合，有成功的，失败的，以及无权限的）。由于成员方法的内部参数与内部类的生命周期的不同，被该成员匿名内部类引用的参数是final的（jdk8中做了默认的处理，这里可以用lamda表达式来写的更为简洁）。这样做带来的一个好处在于，在接口层面的已经做完入参出参的限制后，可以更加灵活的获取到在内部类的一些结果。
- InEntityStatement<> 类，类似于JPA中的JPAReposity,利用泛型获取到实体类型后使用session（这里应该是利用的mybatis的sqlSession）,来实现一些通用的增删改查功能。

  ## 需要帮助

- 导出中为什么要使用TheadLocal变量？<br>

  在导出功能中在线程本地变量中保存了一个ExcelBatchExportService服务，并且在开始导出过程之前会查询整体数据量，以整体数据量和页面大小（最小值为10000）为参数，将数据库内的数据分好页后，按照页为维度将数据不断的写入ExcelBatchEcportService中的workbook中。<br>

    在我看来，无需获取数据的总数以及提前将数据进行分页，可以每一处limit 10000 *i，10000，这样的方式获取数据，写入workBook中，直至查出数据小于10000（说明数据已经结束）.考虑数据量大（超过30w左右）的情况可以对查询条件建立组合索引，以及使用顺序索引（主键）对limit进行优化。<br>

  