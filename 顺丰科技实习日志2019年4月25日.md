# 顺丰科技实习日志

*刘林杰 2019年4月25日*

## 今天内容

- 智慧中转平台需求V1,7 web代码自测
- dubbo的SP是自适应机制代码细节研究

## 明天计划

- dubbo源码分析
- 智慧中转平台剩余需求开发

## 体会感想

- ExtensionLoader类解析
  - 静态属性
    - 三个配置文件目录
    - 缓存的ExtensionLoader类，数据类型concurrentHashmap
    - 缓存的扩展点实现类
  - 自适应SPI机制主要流程
    - 直接缓存中获取实例
    - 缓存中不存在的情况下，生成一个实例并加入缓存
    - 流程如下：
      1. 加载所有配置类信息（缓存）
      2. 存在类被@Adaptive注解修饰，直接返回
      3. 不存在，开始自动生成扩展类代码
      4. 检测扩展点接口是否存在被Adaptive修饰的方法，无抛出异常
      5. 生成包名，导入ExtensionLoader用于获取具扩展实现类
      6. 遍历方法参数以及参数的get方法，用于获取url参数
      7. 生成url属性非空校验代码以及参数的get方法返回值非空校验代码
      8. 获取url值，并生成赋值java代码，将类名从驼峰格式改为x.x.x格式
      9. 对invocation参数做非空校验
      10. 获取扩展名，用于自动生成获取具体扩展实现类的代码
      11. 完成补充生成的java代码，（return语句等）
    - 获取类加载器（applicationClassLoader）
    - 获取Complier扩展点的具体实现类，用于编译自动生成的java代码
    - 编译java代码，获取class类，使用反射(newInstance)生成一个新的实例
    - 缓存这个实例，并返回他
- 在这个流程中多次用到双重检查机制保障线程安全



